<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Order Inbox</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#B00B55;
  --panel:#161616;
  --white:#fff;
}

body{
  font-family:Inter,sans-serif;
  background:#0f0f0f;
  color:#fff;
  margin:0;
  padding:2rem;
}

h1{margin-bottom:1rem}

input,button{
  padding:.7rem;
  border-radius:8px;
  border:1px solid #2a2a2a;
  background:#1a1a1a;
  color:#fff;
}

button{
  cursor:pointer;
  font-weight:600;
}

.home-btn{
  width:100%;
  margin-top:.75rem;
  padding:.65rem 1.1rem;
  background:var(--panel);
  border:1px solid #242424;
  border-radius:10px;
  color:var(--white);
  font-size:.85rem;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}

.home-btn:hover{
  transform:translateY(-2px);
  border-color:var(--pink);
  box-shadow:0 10px 24px rgba(176,11,85,.25);
}

.delete{
  margin-top:.75rem;
  background:#3a0f0f;
  border:1px solid #5a1a1a;
  color:#ffb3b3;
  font-size:.8rem;
}

.login{
  max-width:360px;
  margin:6rem auto;
  background:#161616;
  padding:2rem;
  border-radius:14px;
  border:1px solid #242424;
}

.orders{
  max-width:900px;
  margin:0 auto;
}

.order{
  background:#161616;
  border:1px solid #242424;
  border-radius:12px;
  padding:1rem;
  margin-bottom:1rem;
}

.order small{color:#aaa}
.hidden{display:none}

.logout{
  float:right;
  font-size:.85rem;
}
</style>
</head>

<body>

<div id="loginBox" class="login">
  <h1>Login</h1>
  <input id="email" type="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="Password"><br><br>
  <button onclick="login()">Login</button>
  <button class="home-btn" onclick="location.href='index.html'">Home</button>
  <p id="loginError" style="color:#ff6f6f"></p>
</div>

<div id="ordersBox" class="orders hidden">
  <button class="logout" onclick="logout()">Logout</button>
  <h1>Orders</h1>
  <div id="orders"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ---------- FIREBASE INIT ---------- */

firebase.initializeApp({
  apiKey: "AIzaSyCA51Bs-kNXbNuwbnzJqVuYW9aUQMSAjhE",
  authDomain: "form-8752f.firebaseapp.com",
  databaseURL: "https://form-8752f-default-rtdb.firebaseio.com",
  projectId: "form-8752f",
  storageBucket: "form-8752f.appspot.com",
  messagingSenderId: "615040867765",
  appId: "1:615040867765:web:b9f2ec8bb46de6d035cdfc"
});

const auth = firebase.auth();
const db   = firebase.database();

/* ---------- DOM ---------- */

const loginBox   = document.getElementById("loginBox");
const ordersBox  = document.getElementById("ordersBox");
const ordersDiv  = document.getElementById("orders");
const loginError = document.getElementById("loginError");
const email      = document.getElementById("email");
const password   = document.getElementById("password");

/* ---------- AUTH ---------- */

function login(){
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(err=>{
      loginError.textContent =
        err.code === "auth/wrong-password" ||
        err.code === "auth/user-not-found"
        ? "Invalid email or password."
        : "Login failed. Please try again.";
    });
}

function logout(){
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  if(user){
    loginBox.classList.add("hidden");
    ordersBox.classList.remove("hidden");
    loadOrders();
  }else{
    loginBox.classList.remove("hidden");
    ordersBox.classList.add("hidden");
  }
});

/* ---------- LOAD ORDERS ---------- */

function loadOrders(){
  db.ref("orders").orderByChild("timestamp").on("value", snap => {
    ordersDiv.innerHTML = "";
    const data = snap.val();

    if(!data){
      ordersDiv.innerHTML = "<p>No orders yet.</p>";
      return;
    }

    Object.entries(data).reverse().forEach(([id, o]) => {
      const div = document.createElement("div");
      div.className = "order";

      if (o.type === "contact") {
        div.innerHTML = `
          <strong>Contact Message</strong><br>
          <strong>${o.name}</strong> — ${o.email}<br>
          <small>${new Date(o.timestamp).toLocaleString()}</small>
          <hr>
          <p>${o.message}</p>
          <button class="delete" onclick="deleteOrder('${id}')">Delete</button>
        `;
      }

      else if (o.type === "faq") {
        div.innerHTML = `
          <strong>FAQ Question</strong><br>
          <small>${new Date(o.timestamp).toLocaleString()}</small>
          <hr>
          <p>${o.question}</p>
          <button class="delete" onclick="deleteOrder('${id}')">Delete</button>
        `;
      }

      else {
        div.innerHTML = `
          <strong>${o.name}</strong> — ${o.email}<br>
          <small>${new Date(o.timestamp).toLocaleString()}</small>
          <hr>

          <strong>Payment Plan:</strong>
          <span style="color:#9cffc9">
            ${o.billing || "N/A"}
          </span>

          <h4>Services</h4>
          <ul>${(o.services || []).map(s => `<li>${s}</li>`).join("")}</ul>

          <strong>One-Time:</strong> $${o.oneTimeTotal || 0}<br>
          <strong>Monthly:</strong> $${o.discountedTotal || 0}<br>

          ${o.promoCode ? `<strong>Promo:</strong> ${o.promoCode}<br>` : ""}
          ${o.notes ? `<p>${o.notes}</p>` : ""}

          <button class="delete" onclick="deleteOrder('${id}')">Delete Order</button>
        `;
      }

      ordersDiv.appendChild(div);
    });
  });
}

/* ---------- DELETE ---------- */

function deleteOrder(id){
  if(confirm("Delete this order permanently?")){
    db.ref("orders/"+id).remove();
  }
}
</script>

</body>
</html>
