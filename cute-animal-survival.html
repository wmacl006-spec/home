<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cute Animal Survival</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Comfortaa:wght@500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --pink: #B00B55;
    --black: #0f0f0f;
    --panel: #161616;
    --white: #ffffff;
}

* { box-sizing: border-box; margin:0; padding:0; }

body {
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at top, #1b1b1b, var(--black));
    color: var(--white);
    min-height: 100vh;
    padding: 2rem;
}

.container {
    max-width: 800px;
    margin: auto;
    text-align: center;
}

h1, h2 {
    font-family: 'Comfortaa', sans-serif;
    color: var(--pink);
}

input, button {
    padding: 0.8rem;
    border-radius: 8px;
    border: 1px solid #242424;
    background: var(--panel);
    color: var(--white);
    font-size: 1rem;
    margin: 0.3rem;
}

button:hover { border-color: var(--pink); cursor: pointer; }

.bar {
    width: 300px;
    height: 20px;
    background: #222;
    margin: 6px auto;
    border-radius: 10px;
    overflow: hidden;
}

.fill { height: 100%; }

#homeBtn {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 9999;
}
</style>
</head>

<body>

<button id="homeBtn">Home</button>

<div class="container">
<h1>Cute Animal Survival</h1>

<div id="loginPanel">
    <input type="password" id="passwordInput" placeholder="Enter password">
    <button id="startBtn">Start</button>

    <div id="animalChoice" style="display:none;">
        <h2>Pick an animal</h2>
        <div class="animal-select">
            <img src="cat_alive.png" data-animal="cat">
            <img src="dog_alive.png" data-animal="dog">
            <img src="bunny_alive.png" data-animal="bunny">
            <img src="squirrel_alive.png" data-animal="squirrel">
            <img src="manatee_alive.png" data-animal="manatee">
        </div>
        <input type="text" id="nicknameInput" placeholder="Pet name">
        <button id="confirmAnimalBtn">Confirm</button>
    </div>
</div>

<div id="game" style="display:none;">
    <h2 id="animalName"></h2>
    <img id="animalImg" width="150">

    <div>
        Hunger
        <div class="bar"><div id="hungerBar" class="fill" style="background:#FF69B4;width:100%"></div></div>
        Thirst
        <div class="bar"><div id="thirstBar" class="fill" style="background:#6a1b9a;width:100%"></div></div>
        Health
        <div class="bar"><div id="healthBar" class="fill" style="background:#B00B55;width:100%"></div></div>
    </div>

    <p>
        Food: <span id="foodCount">0</span> |
        Water: <span id="waterCount">0</span> |
        Coins: <span id="coinCount">0</span>
    </p>

    <p>
        Food Gen Lv: <span id="foodLvl">0</span> |
        Water Gen Lv: <span id="waterLvl">0</span>
    </p>

    <div id="gameControls">
        <button id="feedBtn">Feed (15 Food)</button>
        <button id="drinkBtn">Drink (20 Water)</button><br>

        <button id="upgradeFoodBtn">Upgrade Food Gen (65 Water)</button>
        <button id="upgradeWaterBtn">Upgrade Water Gen (75 Food)</button><br>

        <button id="sellFoodBtn">Sell 5 Food (+25 Coins)</button>
        <button id="sellWaterBtn">Sell 5 Water (+20 Coins)</button><br>

        <button id="buyFoodBtn">Buy 5 Food (30 Coins)</button>
        <button id="buyWaterBtn">Buy 5 Water (25 Coins)</button>
    </div>

    <button id="tryAgainBtn" style="display:none;">Try Again</button>

    <h2>Leaderboard</h2>
    <div id="leaderboard"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const app = initializeApp({
    databaseURL: "https://lilguys-ae7fe-default-rtdb.firebaseio.com/"
});
const db = getDatabase(app);

const $ = id => document.getElementById(id);

/* NAV */
$("homeBtn").onclick = () => location.href = "index.html";

/* BUTTONS */
$("startBtn").onclick = handleLogin;
$("confirmAnimalBtn").onclick = confirmAnimal;
$("feedBtn").onclick = feed;
$("drinkBtn").onclick = drink;
$("upgradeFoodBtn").onclick = () => upgrade("food");
$("upgradeWaterBtn").onclick = () => upgrade("water");
$("sellFoodBtn").onclick = sellFood;
$("sellWaterBtn").onclick = sellWater;
$("buyFoodBtn").onclick = buyFood;
$("buyWaterBtn").onclick = buyWater;
$("tryAgainBtn").onclick = () => location.reload();

const images = {
    cat:{alive:"cat_alive.png",dead:"cat_dead.png"},
    dog:{alive:"dog_alive.png",dead:"dog_dead.png"},
    bunny:{alive:"bunny_alive.png",dead:"bunny_dead.png"},
    squirrel:{alive:"squirrel_alive.png",dead:"squirrel_dead.png"},
    manatee:{alive:"manatee_alive.png",dead:"manatee_dead.png"}
};

let player, password, selectedAnimal, loop;

/* LOGIN */
async function handleLogin(){
    password = $("passwordInput").value.trim();
    if(!password) return;

    const snap = await get(ref(db,"players/"+password));
    player = snap.exists() ? snap.val() : {
        hunger:100, thirst:100, health:100,
        food:0, water:0, coins:0,
        foodGeneratorLevel:0,
        waterGeneratorLevel:0
    };

    if(!player.animal) $("animalChoice").style.display="block";
    else startGame();
}

document.querySelectorAll(".animal-select img").forEach(img=>{
    img.onclick = ()=>{
        selectedAnimal = img.dataset.animal;
        document.querySelectorAll(".animal-select img").forEach(i=>i.classList.remove("selected"));
        img.classList.add("selected");
    };
});

function confirmAnimal(){
    if(!selectedAnimal || !$("nicknameInput").value) return;
    player.animal = selectedAnimal;
    player.nickname = $("nicknameInput").value;
    player.startTime = Date.now();
    startGame();
}

/* GAME */
function startGame(){
    $("loginPanel").style.display="none";
    $("game").style.display="block";
    $("animalName").innerText = player.nickname;
    $("animalImg").src = images[player.animal].alive;
    loop = setInterval(tick,1000);
}

function tick(){
    player.hunger=Math.max(0,player.hunger-1);
    player.thirst=Math.max(0,player.thirst-1.5);

    if(player.hunger===0 && player.thirst===0) player.health-=5;
    else if(player.hunger===0 || player.thirst===0) player.health-=1;

    player.food+=0.5+player.foodGeneratorLevel*0.35;
    player.water+=0.6+player.waterGeneratorLevel*0.35;

    updateUI();
    set(ref(db,"players/"+password),player);

    if(player.health<=0){
        clearInterval(loop);
        $("animalImg").src = images[player.animal].dead;
        $("gameControls").style.display="none";
        $("tryAgainBtn").style.display="inline-block";
        saveLeaderboard();
    }
}

/* ACTIONS */
function feed(){
    if(player.food>=15){
        player.food-=15;
        player.hunger=Math.min(100,player.hunger+15);
    }
}
function drink(){
    if(player.water>=20){
        player.water-=20;
        player.thirst=Math.min(100,player.thirst+20);
    }
}
function upgrade(type){
    if(type==="food" && player.water>=65){
        player.water-=65; player.foodGeneratorLevel++;
    }
    if(type==="water" && player.food>=75){
        player.food-=75; player.waterGeneratorLevel++;
    }
}
function sellFood(){
    if(player.food>=5){
        player.food-=5;
        player.coins+=25;
    }
}
function sellWater(){
    if(player.water>=5){
        player.water-=5;
        player.coins+=20;
    }
}
function buyFood(){
    if(player.coins>=30){
        player.coins-=30;
        player.food+=5;
    }
}
function buyWater(){
    if(player.coins>=25){
        player.coins-=25;
        player.water+=5;
    }
}

/* UI */
function updateUI(){
    $("hungerBar").style.width=player.hunger+"%";
    $("thirstBar").style.width=player.thirst+"%";
    $("healthBar").style.width=player.health+"%";
    $("foodCount").innerText=Math.floor(player.food);
    $("waterCount").innerText=Math.floor(player.water);
    $("coinCount").innerText=player.coins;
    $("foodLvl").innerText=player.foodGeneratorLevel;
    $("waterLvl").innerText=player.waterGeneratorLevel;
}

/* LEADERBOARD */
async function saveLeaderboard(){
    const time=Date.now()-player.startTime;
    await set(ref(db,"leaderboard/"+password),{
        name:player.nickname,
        time
    });
    loadLeaderboard();
}
async function loadLeaderboard(){
    const snap=await get(ref(db,"leaderboard"));
    if(!snap.exists()){
        $("leaderboard").innerHTML="<p>No entries yet</p>";
        return;
    }
    const arr=Object.values(snap.val()).sort((a,b)=>b.time-a.time);
    $("leaderboard").innerHTML="<ol>"+arr.map(e=>{
        const m=Math.floor(e.time/60000);
        const s=Math.floor((e.time%60000)/1000);
        return `<li>${e.name} â€” ${m}m ${s}s</li>`;
    }).join("")+"</ol>";
}

loadLeaderboard();
</script>
</body>
</html>
