<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cute Animal Survival</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Comfortaa:wght@500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --pink:#B00B55;
    --black:#0f0f0f;
    --panel:#161616;
    --white:#ffffff;
}

* { box-sizing:border-box; margin:0; padding:0; }

body {
    font-family:'Inter',sans-serif;
    background:radial-gradient(circle at top,#1b1b1b,var(--black));
    color:var(--white);
    min-height:100vh;
    padding:2rem;
}

.container { max-width:800px; margin:auto; text-align:center; }

h1,h2 { font-family:'Comfortaa',sans-serif; color:var(--pink); }

input,button {
    padding:.8rem;
    border-radius:8px;
    border:1px solid #242424;
    background:var(--panel);
    color:var(--white);
    font-size:1rem;
    margin:.3rem;
}

button:hover { border-color:var(--pink); cursor:pointer; }

.bar {
    width:300px;
    height:20px;
    background:#222;
    margin:6px auto;
    border-radius:10px;
    overflow:hidden;
}

.fill { height:100%; }

.animal-select {
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    margin-top:.5rem;
}

.animal-select img {
    width:64px;
    height:64px;
    object-fit:contain;
    margin:6px;
    cursor:pointer;
    border-radius:8px;
    border:2px solid transparent;
}

.animal-select img.selected {
    border-color:var(--pink);
}

#homeBtn {
    position:fixed;
    top:12px;
    left:12px;
    z-index:9999;
}

/* TIMER */
#survivalTimer {
    margin:.4rem 0 1rem;
    font-family:Comfortaa,sans-serif;
    font-size:1.15rem;
    color:#ff8fcf;
}

#survivalTimer.danger {
    animation:pulse 1s infinite;
    color:#ff4f8b;
}

@keyframes pulse {
    0% { opacity:1; }
    50% { opacity:.4; }
    100% { opacity:1; }
}
</style>
</head>

<body>

<button id="homeBtn">Home</button>

<div class="container">
<h1>Animal Survival</h1>

<div id="loginPanel">
    <input type="password" id="passwordInput" placeholder="Create/Enter password" style="margin-top:1.3rem;">
    <button id="startBtn">Start</button>

    <div id="animalChoice" style="display:none;">
        <h2>Pick an animal</h2>
        <div class="animal-select">
            <img src="cat_alive.png" data-animal="cat">
            <img src="dog_alive.png" data-animal="dog">
            <img src="bunny_alive.png" data-animal="bunny">
            <img src="squirrel_alive.png" data-animal="squirrel">
            <img src="manatee_alive.png" data-animal="manatee">
        </div>
        <input type="text" id="nicknameInput" placeholder="Pet name">
        <button id="confirmAnimalBtn">Confirm</button>
    </div>
</div>

<div id="game" style="display:none;">
    <h2 id="animalName"></h2>
    <div id="survivalTimer">Survived: 0m 0s</div>

    <img id="animalImg" width="150">

    <div>
        Hunger<div class="bar"><div id="hungerBar" class="fill" style="background:#FF69B4;width:100%"></div></div>
        Thirst<div class="bar"><div id="thirstBar" class="fill" style="background:#6a1b9a;width:100%"></div></div>
        Health<div class="bar"><div id="healthBar" class="fill" style="background:#B00B55;width:100%"></div></div>
    </div>

    <p>
        Food: <span id="foodCount">0</span> |
        Water: <span id="waterCount">0</span> |
        Coins: <span id="coinCount">0</span>
    </p>

    <p>
        Food Gen Lv: <span id="foodLvl">0</span> |
        Water Gen Lv: <span id="waterLvl">0</span>
    </p>

    <div id="gameControls">
        <button id="feedBtn">Feed (15 Food)</button>
        <button id="drinkBtn">Drink (20 Water)</button><br>

        <button id="upgradeFoodBtn">Upgrade Food Gen (65 Water)</button>
        <button id="upgradeWaterBtn">Upgrade Water Gen (75 Food)</button><br>

        <button id="sellFoodBtn">Sell 5 Food (+22 Coins)</button>
        <button id="sellWaterBtn">Sell 5 Water (+20 Coins)</button><br>

        <button id="buyFoodBtn">Buy 5 Food (25 Coins)</button>
        <button id="buyWaterBtn">Buy 5 Water (23 Coins)</button>
    </div>

    <button id="tryAgainBtn" style="display:none;">Try Again</button>

    <h2>Survival Time Leaderboard</h2>
    <div id="leaderboardTime"></div>

    <h2>Richest Pets (All-Time)</h2>
    <div id="leaderboardCoins"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const app = initializeApp({ databaseURL:"https://lilguys-ae7fe-default-rtdb.firebaseio.com/" });
const db = getDatabase(app);
const $ = id => document.getElementById(id);

$("homeBtn").onclick = () => location.href="index.html";
$("startBtn").onclick = login;
$("confirmAnimalBtn").onclick = confirmAnimal;
$("feedBtn").onclick = feed;
$("drinkBtn").onclick = drink;
$("upgradeFoodBtn").onclick = () => upgrade("food");
$("upgradeWaterBtn").onclick = () => upgrade("water");
$("sellFoodBtn").onclick = sellFood;
$("sellWaterBtn").onclick = sellWater;
$("buyFoodBtn").onclick = buyFood;
$("buyWaterBtn").onclick = buyWater;
$("tryAgainBtn").onclick = () => location.reload();

const images={
cat:{alive:"cat_alive.png",dead:"cat_dead.png"},
dog:{alive:"dog_alive.png",dead:"dog_dead.png"},
bunny:{alive:"bunny_alive.png",dead:"bunny_dead.png"},
squirrel:{alive:"squirrel_alive.png",dead:"squirrel_dead.png"},
manatee:{alive:"manatee_alive.png",dead:"manatee_dead.png"}
};

let player,password,selectedAnimal,loop;

/* ---------- HELPERS ---------- */
function formatTime(ms){
    const s=Math.floor(ms/1000);
    return `${Math.floor(s/60)}m ${s%60}s`;
}

/* ---------- LOGIN ---------- */
async function login(){
    password=$("passwordInput").value.trim();
    if(!password) return;

    const blocked = await get(ref(db,"blockedPasswords/"+password));
    if(blocked.exists()){ alert("Try a different password."); return; }

    const snap=await get(ref(db,"players/"+password));
    player=snap.exists()?snap.val():{
        hunger:100,thirst:100,health:100,
        food:0,water:0,coins:0,maxCoins:0,
        foodGeneratorLevel:0,waterGeneratorLevel:0
    };

    if(!player.animal) $("animalChoice").style.display="block";
    else startGame();
}

document.querySelectorAll(".animal-select img").forEach(img=>{
    img.onclick=()=>{
        selectedAnimal=img.dataset.animal;
        document.querySelectorAll(".animal-select img").forEach(i=>i.classList.remove("selected"));
        img.classList.add("selected");
    };
});

function confirmAnimal(){
    if(!selectedAnimal||!$("nicknameInput").value) return;
    player.animal=selectedAnimal;
    player.nickname=$("nicknameInput").value;
    player.startTime=Date.now();
    startGame();
}

function startGame(){
    $("loginPanel").style.display="none";
    $("game").style.display="block";
    $("animalName").innerText=player.nickname;
    $("animalImg").src=images[player.animal].alive;
    if(!player.startTime) player.startTime=Date.now();
    loop=setInterval(tick,1000);
}

/* ---------- GAME LOOP ---------- */
function tick(){
    const elapsed=Date.now()-player.startTime;
    $("survivalTimer").innerText="Survived: "+formatTime(elapsed);

    const stages=Math.floor(elapsed/60000);
    player.hunger=Math.max(0,player.hunger-(1.35*Math.pow(1.2,stages)));
    player.thirst=Math.max(0,player.thirst-(1.5*Math.pow(1.3,stages)));

    if(player.hunger===0&&player.thirst===0) player.health-=5;
    else if(player.hunger===0||player.thirst===0) player.health-=1;

    if(player.health<25) $("survivalTimer").classList.add("danger");

    player.food+=1.2+player.foodGeneratorLevel*0.35;
    player.water+=1.6+player.waterGeneratorLevel*0.35;

    updateUI();
    set(ref(db,"players/"+password),player);

    if(player.health<=0){
        clearInterval(loop);
        $("animalImg").src=images[player.animal].dead;
        $("gameControls").style.display="none";
        $("tryAgainBtn").style.display="inline-block";
        onDeath(elapsed);
    }
}

function onDeath(time){
    set(ref(db,"blockedPasswords/"+password),true);
    saveLeaderboards(time);
}

/* ---------- ACTIONS ---------- */
function feed(){ if(player.food>=15){player.food-=15;player.hunger=Math.min(100,player.hunger+15);} }
function drink(){ if(player.water>=20){player.water-=20;player.thirst=Math.min(100,player.thirst+20);} }
function upgrade(t){
    if(t==="food"&&player.water>=65){player.water-=65;player.foodGeneratorLevel++;}
    if(t==="water"&&player.food>=75){player.food-=75;player.waterGeneratorLevel++;}
}
function sellFood(){ if(player.food>=5){player.food-=5;player.coins+=22;} }
function sellWater(){ if(player.water>=5){player.water-=5;player.coins+=20;} }
function buyFood(){ if(player.coins>=25){player.coins-=25;player.food+=5;} }
function buyWater(){ if(player.coins>=23){player.coins-=23;player.water+=5;} }

/* ---------- UI ---------- */
function updateUI(){
    $("hungerBar").style.width=player.hunger+"%";
    $("thirstBar").style.width=player.thirst+"%";
    $("healthBar").style.width=player.health+"%";
    $("foodCount").innerText=Math.floor(player.food);
    $("waterCount").innerText=Math.floor(player.water);
    $("coinCount").innerText=player.coins;
    $("foodLvl").innerText=player.foodGeneratorLevel;
    $("waterLvl").innerText=player.waterGeneratorLevel;
}

/* ---------- LEADERBOARDS ---------- */
async function saveLeaderboards(time){
    await set(ref(db,"leaderboard_time/"+password),{name:player.nickname,time});
    await set(ref(db,"leaderboard_coins/"+password),{name:player.nickname,coins:player.maxCoins});
    loadLeaderboards();
}

async function loadLeaderboards(){
    loadLB("leaderboard_time","leaderboardTime",e=>formatTime(e.time));
    loadLB("leaderboard_coins","leaderboardCoins",e=>`${e.coins} coins`);
}

async function loadLB(path,el,fmt){
    const snap=await get(ref(db,path));
    if(!snap.exists()){ $(el).innerHTML="<p>No entries</p>"; return; }
    const arr=Object.values(snap.val()).sort((a,b)=>(b.time||b.coins)-(a.time||a.coins));
    $(el).innerHTML="<ol>"+arr.map(e=>`<li>${fmt(e)}</li>`).join("")+"</ol>";
}

loadLeaderboards();
</script>
</body>
</html>
