<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animal Survival</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Comfortaa:wght@500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --pink:#B00B55;
  --bg:#0f0f0f;
  --panel:#161616;
}

* { box-sizing:border-box; margin:0; padding:0; }

body {
  background:radial-gradient(circle at top,#1b1b1b,var(--bg));
  font-family:Inter,sans-serif;
  color:white;
  min-height:100vh;
  padding:2rem;
}

.container { max-width:820px; margin:auto; text-align:center; }

h1,h2 {
  font-family:Comfortaa,sans-serif;
  color:var(--pink);
}

button,input {
  background:var(--panel);
  color:white;
  border:1px solid #242424;
  padding:.8rem;
  border-radius:8px;
  margin:.25rem;
  font-size:1rem;
}

button:hover { border-color:var(--pink); cursor:pointer; }

.bar {
  width:320px;
  height:20px;
  background:#222;
  border-radius:10px;
  margin:6px auto;
  overflow:hidden;
}

.fill { height:100%; }

.animal-select {
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  margin:.75rem 0;
}

.animal-select img {
  width:64px;
  height:64px;
  margin:6px;
  border-radius:10px;
  border:2px solid transparent;
  cursor:pointer;
  background:#111;
}

.animal-select img.selected {
  border-color:var(--pink);
}

#animalImg {
  width:150px;
  margin:.75rem 0;
}

#survivalTimer {
  font-family:Comfortaa,sans-serif;
  margin-bottom:.75rem;
}
</style>
</head>

<body>

<div class="container">
<h1>Animal Survival</h1>

<div id="loginPanel">
  <input id="passwordInput" type="password" placeholder="Create / Enter password">
  <button id="startBtn">Start</button>

  <div id="animalChoice" style="display:none;margin-top:1rem">
    <h2>Pick an animal</h2>

    <div class="animal-select">
      <img data-animal="cat">
      <img data-animal="dog">
      <img data-animal="bunny">
      <img data-animal="squirrel">
      <img data-animal="manatee">
    </div>

    <input id="nicknameInput" placeholder="Pet name">
    <button id="confirmAnimalBtn">Confirm</button>
  </div>
</div>

<div id="game" style="display:none">
  <h2 id="animalName"></h2>
  <div id="survivalTimer">Survived: 0m 0s</div>

  <img id="animalImg">

  Hunger<div class="bar"><div id="hungerBar" class="fill" style="background:#ff69b4;width:100%"></div></div>
  Thirst<div class="bar"><div id="thirstBar" class="fill" style="background:#7b1fa2;width:100%"></div></div>
  Health<div class="bar"><div id="healthBar" class="fill" style="background:#B00B55;width:100%"></div></div>

  <p>
    Food: <span id="foodCount">0</span> |
    Water: <span id="waterCount">0</span> |
    Coins: <span id="coinCount">0</span>
  </p>

  <p>
    Food Gen Lv: <span id="foodLvl">0</span> |
    Water Gen Lv: <span id="waterLvl">0</span>
  </p>

  <div id="gameControls">
    <button id="feedBtn">Feed (15 Food)</button>
    <button id="drinkBtn">Drink (20 Water)</button><br>

    <button id="upgradeFoodBtn">Upgrade Food Gen (65 Water)</button>
    <button id="upgradeWaterBtn">Upgrade Water Gen (75 Food)</button><br>

    <button id="sellFoodBtn">Sell 5 Food (+22 Coins)</button>
    <button id="sellWaterBtn">Sell 5 Water (+20 Coins)</button><br>

    <button id="buyFoodBtn">Buy 5 Food (25 Coins)</button>
    <button id="buyWaterBtn">Buy 5 Water (23 Coins)</button>
  </div>

  <button id="tryAgainBtn" style="display:none;margin-top:1rem">Try Again</button>

  <h2>Survival Time Leaderboard</h2>
  <div id="leaderboardTime"></div>

  <h2>Richest Pets</h2>
  <div id="leaderboardCoins"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const ASSETS = "../gamepic/";

const images = {
  cat:{alive:"cat_alive.png",dead:"cat_dead.png"},
  dog:{alive:"dog_alive.png",dead:"dog_dead.png"},
  bunny:{alive:"bunny_alive.png",dead:"bunny_dead.png"},
  squirrel:{alive:"squirrel_alive.png",dead:"squirrel_dead.png"},
  manatee:{alive:"manatee_alive.png",dead:"manatee_dead.png"}
};

const app = initializeApp({ databaseURL:"https://lilguys-ae7fe-default-rtdb.firebaseio.com/" });
const db = getDatabase(app);
const $ = id => document.getElementById(id);

let player,password,selectedAnimal,loop;

document.querySelectorAll(".animal-select img").forEach(img=>{
  const a=img.dataset.animal;
  img.src=ASSETS+images[a].alive;
  img.onclick=()=>{
    selectedAnimal=a;
    document.querySelectorAll(".animal-select img").forEach(i=>i.classList.remove("selected"));
    img.classList.add("selected");
  };
});

$("startBtn").onclick=login;
$("confirmAnimalBtn").onclick=confirmAnimal;
$("feedBtn").onclick=feed;
$("drinkBtn").onclick=drink;
$("upgradeFoodBtn").onclick=()=>upgrade("food");
$("upgradeWaterBtn").onclick=()=>upgrade("water");
$("sellFoodBtn").onclick=sellFood;
$("sellWaterBtn").onclick=sellWater;
$("buyFoodBtn").onclick=buyFood;
$("buyWaterBtn").onclick=buyWater;
$("tryAgainBtn").onclick=()=>location.reload();

function formatTime(ms){
  const s=Math.floor(ms/1000);
  return `${Math.floor(s/60)}m ${s%60}s`;
}

async function login(){
  password=$("passwordInput").value.trim();
  if(!password) return;

  const blocked=await get(ref(db,"blockedPasswords/"+password));
  if(blocked.exists()) return alert("Password already used.");

  const snap=await get(ref(db,"players/"+password));
  player=snap.exists()?snap.val():{
    hunger:100,thirst:100,health:100,
    food:0,water:0,coins:0,maxCoins:0,
    foodGeneratorLevel:0,waterGeneratorLevel:0
  };

  if(!player.animal) $("animalChoice").style.display="block";
  else startGame();
}

function confirmAnimal(){
  if(!selectedAnimal||!$("nicknameInput").value) return;
  player.animal=selectedAnimal;
  player.nickname=$("nicknameInput").value;
  player.startTime=Date.now();
  startGame();
}

function startGame(){
  $("loginPanel").style.display="none";
  $("game").style.display="block";
  $("animalName").innerText=player.nickname;
  $("animalImg").src=ASSETS+images[player.animal].alive;
  loop=setInterval(tick,1000);
}

function tick(){
  const elapsed=Date.now()-player.startTime;
  $("survivalTimer").innerText="Survived: "+formatTime(elapsed);

  const stage=Math.floor(elapsed/300000);
  player.hunger=Math.max(0,player.hunger-(1.15*Math.pow(1.1,stage)));
  player.thirst=Math.max(0,player.thirst-(1.35*Math.pow(1.15,stage)));

  if(player.hunger===0||player.thirst===0) player.health-=1;

  player.food+=1+player.foodGeneratorLevel;
  player.water+=1.3+player.waterGeneratorLevel;

  updateUI();
  set(ref(db,"players/"+password),player);

  if(player.health<=0){
    clearInterval(loop);
    $("animalImg").src=ASSETS+images[player.animal].dead;
    $("gameControls").style.display="none";
    $("tryAgainBtn").style.display="inline-block";
    set(ref(db,"blockedPasswords/"+password),true);
  }
}

function feed(){ if(player.food>=15){player.food-=15;player.hunger=Math.min(100,player.hunger+15);} }
function drink(){ if(player.water>=20){player.water-=20;player.thirst=Math.min(100,player.thirst+20);} }
function upgrade(t){
  if(t==="food"&&player.water>=65){player.water-=65;player.foodGeneratorLevel++;}
  if(t==="water"&&player.food>=75){player.food-=75;player.waterGeneratorLevel++;}
}
function sellFood(){ if(player.food>=5){player.food-=5;player.coins+=22;} }
function sellWater(){ if(player.water>=5){player.water-=5;player.coins+=20;} }
function buyFood(){ if(player.coins>=25){player.coins-=25;player.food+=5;} }
function buyWater(){ if(player.coins>=23){player.coins-=23;player.water+=5;} }

function updateUI(){
  $("hungerBar").style.width=player.hunger+"%";
  $("thirstBar").style.width=player.thirst+"%";
  $("healthBar").style.width=player.health+"%";
  $("foodCount").innerText=Math.floor(player.food);
  $("waterCount").innerText=Math.floor(player.water);
  $("coinCount").innerText=player.coins;
  $("foodLvl").innerText=player.foodGeneratorLevel;
  $("waterLvl").innerText=player.waterGeneratorLevel;
}
</script>
</body>
</html>
