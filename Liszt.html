<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Liszt</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: #0f0f0f;
  color: white;
}
.hidden { display: none; }
.center {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.card {
  background: #161616;
  padding: 24px;
  border-radius: 14px;
  width: 320px;
  box-shadow: 0 20px 40px rgba(0,0,0,.4);
}
input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
}
input { background: #0f0f0f; color: white; }
button {
  background: #B00B55;
  color: white;
  cursor: pointer;
}
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px,1fr));
  gap: 16px;
  padding: 20px;
}
.user-card {
  background: #161616;
  border-radius: 14px;
  padding: 16px;
  text-align: center;
}
.user-card .field {
  font-size: 12px;
  opacity: .7;
}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth" class="center">
  <div class="card">
    <h2>Liszt</h2>
    <input id="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password (6+ chars)" />
    <button id="signup">Sign Up</button>
    <button id="login">Log In</button>
  </div>
</div>

<!-- ONBOARD -->
<div id="onboard" class="center hidden">
  <div class="card">
    <h3 id="stepTitle"></h3>
    <input id="stepInput" />
    <button id="nextStep">Next</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div class="gallery" id="gallery"></div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD8LdaUeS-bDvT1oAQteRnndQDDB86n4Ds",
  authDomain: "liszt-df660.firebaseapp.com",
  projectId: "liszt-df660"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authDiv = document.getElementById("auth");
const onboardDiv = document.getElementById("onboard");
const appDiv = document.getElementById("app");

const steps = ["Name", "Username", "Field", "About"];
let step = 0;
let data = {};
let userRef;

document.getElementById("signup").onclick = async () => {
  await createUserWithEmailAndPassword(
    auth,
    email.value,
    password.value
  );
};

document.getElementById("login").onclick = async () => {
  await signInWithEmailAndPassword(
    auth,
    email.value,
    password.value
  );
};

onAuthStateChanged(auth, async user => {
  if (!user) return;

  authDiv.classList.add("hidden");
  userRef = doc(db, "users", user.uid);
  const snap = await getDoc(userRef);

  if (!snap.exists()) {
    onboardDiv.classList.remove("hidden");
    loadStep();
  } else {
    startApp();
  }
});

function loadStep() {
  stepTitle.innerText = steps[step];
  stepInput.value = "";
}

nextStep.onclick = async () => {
  data[steps[step].toLowerCase()] = stepInput.value;
  step++;

  if (step < steps.length) {
    loadStep();
  } else {
    await setDoc(userRef, data);
    onboardDiv.classList.add("hidden");
    startApp();
  }
};

async function startApp() {
  appDiv.classList.remove("hidden");
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";

  const snap = await getDocs(collection(db, "users"));
  snap.forEach(doc => {
    const u = doc.data();
    const card = document.createElement("div");
    card.className = "user-card";
    card.innerHTML = `
      <div class="field">${u.field || ""}</div>
      <strong>${u.name || ""}</strong>
    `;
    gallery.appendChild(card);
  });
}
</script>

</body>
</html>
