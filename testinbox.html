<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f0f0f;
  --panel:#171717;
  --text:#fff;
  --muted:#9a9a9a;
  --accent:#4f8cff;
  --danger:#ff5c5c;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:700px;
  margin:0 auto;
  padding:2rem 1.25rem 3rem;
}

.topbar{
  display:flex;
  justify-content:space-between;
  margin-bottom:1rem;
}

.topbtn{
  background:#2a2a2a;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:.45rem .75rem;
  font-size:.8rem;
  cursor:pointer;
}

.logout{
  background:var(--danger);
}

h1{
  font-size:1.4rem;
  margin-bottom:1rem;
}

.card{
  background:var(--panel);
  border-radius:14px;
  padding:1rem;
  margin-bottom:.8rem;
}

.meta{
  font-size:.8rem;
  color:var(--muted);
  margin-bottom:.4rem;
}

.message{
  font-size:.95rem;
  line-height:1.5;
}

.actions{
  margin-top:.6rem;
}

.archive{
  background:#2a2a2a;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:.4rem .7rem;
  font-size:.8rem;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

  <div class="topbar">
    <button class="topbtn" onclick="goHome()">Home</button>
    <button class="topbtn logout" onclick="logout()">Logout</button>
  </div>

  <h1>Inbox</h1>
  <div id="inbox"></div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCF5v32i84og9RDyE2HbHW26viV_I2fIDE",
  authDomain: "test-c8289.firebaseapp.com",
  databaseURL: "https://test-c8289-default-rtdb.firebaseio.com",
  projectId: "test-c8289",
  storageBucket: "test-c8289.firebasestorage.app",
  messagingSenderId: "96205633785",
  appId: "1:96205633785:web:7647d9c4539d8c36358a28"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

/* AUTH GUARD */
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    loadInbox();
  }
});

/* LOAD MESSAGES */
function loadInbox(){
  const inbox = document.getElementById("inbox");
  inbox.innerHTML = "";

  db.ref("contacts").on("value", snap => {
    inbox.innerHTML = "";

    if (!snap.exists()) {
      inbox.innerHTML = "<p style='color:#777'>No messages</p>";
      return;
    }

    snap.forEach(child => {
      const data = child.val();
      const id = child.key;

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <div class="meta">
          <strong>${data.name}</strong> â€¢ ${data.contact}<br>
          ${new Date(data.timestamp).toLocaleString()}
        </div>
        <div class="message">${data.message}</div>
        <div class="actions">
          <button class="archive" onclick="archive('${id}')">Archive</button>
        </div>
      `;

      inbox.appendChild(card);
    });
  });
}

/* ARCHIVE */
function archive(id){
  const ref = db.ref("contacts/" + id);
  ref.once("value").then(snap => {
    db.ref("archived/" + id).set(snap.val());
    ref.remove();
  });
}

/* LOGOUT */
function logout(){
  auth.signOut().then(() => {
    window.location.href = "login.html";
  });
}

function goHome(){
  window.location.href = "test.html";
}
</script>
</body>
</html>
