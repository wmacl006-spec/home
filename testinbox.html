<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f0f0f;
  --panel:#171717;
  --text:#fff;
  --muted:#9a9a9a;
  --accent:#4f8cff;
  --danger:#ff5c5c;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:700px;
  margin:0 auto;
  padding:2rem 1.25rem 3rem;
}

.card{
  background:var(--panel);
  border-radius:14px;
  padding:1rem;
  margin-bottom:1rem;
}

input{
  width:100%;
  padding:.6rem;
  margin:.4rem 0;
  border-radius:8px;
  border:1px solid #2a2a2a;
  background:#111;
  color:#fff;
}

button{
  border:none;
  border-radius:8px;
  padding:.5rem .9rem;
  background:#2a2a2a;
  color:#fff;
  cursor:pointer;
}

.primary{ background:var(--accent); }
.danger{ background:var(--danger); }

.topbar{
  display:flex;
  justify-content:space-between;
  margin-bottom:1rem;
}

.meta{
  font-size:.8rem;
  color:var(--muted);
}

.message{
  margin-top:.4rem;
  font-size:.95rem;
}
</style>
</head>

<body>
<div class="container">

<!-- LOGIN VIEW -->
<div id="loginView" class="card" style="display:none">
  <h2>Inbox Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button class="primary" onclick="login()">Sign In</button>
</div>

<!-- INBOX VIEW -->
<div id="inboxView" style="display:none">

  <div class="topbar">
    <button onclick="goHome()">Home</button>
    <button class="danger" onclick="logout()">Logout</button>
  </div>

  <h1>Inbox</h1>
  <div id="inbox"></div>

</div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ---------- FIREBASE CONFIG ---------- */
firebase.initializeApp({
  apiKey: "AIzaSyCF5v32i84og9RDyE2HbHW26viV_I2fIDE",
  authDomain: "test-c8289.firebaseapp.com",
  databaseURL: "https://test-c8289-default-rtdb.firebaseio.com",
  projectId: "test-c8289",
  storageBucket: "test-c8289.firebasestorage.app",
  messagingSenderId: "96205633785",
  appId: "1:96205633785:web:7647d9c4539d8c36358a28"
});

const auth = firebase.auth();
const db = firebase.database();

const loginView = document.getElementById("loginView");
const inboxView = document.getElementById("inboxView");

/* ---------- AUTH STATE (NO REDIRECTS) ---------- */
auth.onAuthStateChanged(user => {
  if (user) {
    loginView.style.display = "none";
    inboxView.style.display = "block";
    loadInbox();
  } else {
    inboxView.style.display = "none";
    loginView.style.display = "block";
  }
});

/* ---------- LOGIN ---------- */
function login(){
  auth.signInWithEmailAndPassword(
    email.value,
    password.value
  ).catch(err => alert(err.message));
}

/* ---------- LOAD INBOX ---------- */
function loadInbox(){
  const inbox = document.getElementById("inbox");
  inbox.innerHTML = "";

  db.ref("contacts").on("value", snap => {
    inbox.innerHTML = "";

    if (!snap.exists()) {
      inbox.innerHTML = "<p style='color:#777'>No messages</p>";
      return;
    }

    snap.forEach(child => {
      const d = child.val();
      const id = child.key;

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <div class="meta">
          <strong>${d.name}</strong> â€¢ ${d.contact}<br>
          ${new Date(d.timestamp).toLocaleString()}
        </div>
        <div class="message">${d.message}</div>
        <button onclick="archive('${id}')">Archive</button>
      `;

      inbox.appendChild(card);
    });
  });
}

/* ---------- ARCHIVE ---------- */
function archive(id){
  const ref = db.ref("contacts/" + id);
  ref.once("value").then(snap => {
    db.ref("archived/" + id).set(snap.val());
    ref.remove();
  });
}

/* ---------- LOGOUT ---------- */
function logout(){
  auth.signOut();
}

/* ---------- HOME ---------- */
function goHome(){
  window.location.href = "test.html";
}
</script>
</body>
</html>
